# 0121 세션 작업 내역 및 백엔드 개발 플랜

## 1. 오늘 세션 작업 내역 (0121)

### 1.1 수모 가격 정보 일관성 수정
- **문제**: "2장 1.5만원" → "2장 3만원(장당 1.5만원)"으로 수정 필요
- **수정 파일**:
  - `public/rules/rules.md` - 첫 입금 금액 표 수정 (3.5만원→5만원, 1.5만원→3만원)
  - `src/lib/constants.ts` - SIGNUP_CHECKLIST_ITEMS 설명 수정
  - `src/lib/api.ts` - DEFAULT_CHECKLIST_ITEMS 설명 수정

### 1.2 회칙 문서 표현 개선
- "회비 면제"라는 오해의 소지 있는 표현 → "익월 입회"로 변경
- 첫 입금 안내 표에 금액 구성 설명 추가 (예: "5만원 (회비 2만 + 수모 3만)")

### 1.3 정원 마감 시 가입 신청 차단 기능
- **HomePage.tsx**: 정원 꽉 찼을 때 "가입 신청하기" 버튼 비활성화
- **Header.tsx**: 데스크톱/모바일 메뉴에서 "정원 마감" 표시
- **ApplyPage.tsx**: URL 직접 접근 시에도 안내 화면 표시

### 1.4 일반 회원 대시보드 홈 구현
- **기존 문제**: 로그인 시 `/my`로 리다이렉트 → 개인정보 수정 페이지라 부적절
- **개선**:
  - 환영 메시지 + 내 상태 (활성/휴면, 담당 역할)
  - 정원 현황 시각화
  - 최근 가입 회원 (1개월 이내)
  - 최근 상태 변경 (휴면 전환, 활성 복귀, 탈퇴)
  - 바로가기 (회원목록, 회칙, 내 정보)
- **수정 파일**:
  - `src/lib/types.ts` - StatusChangeHistory 타입 추가
  - `src/lib/api.ts` - 상태 변경 이력 관련 함수 추가
  - `src/lib/mockData.ts` - 테스트 데이터 추가
  - `src/pages/HomePage.tsx` - 대시보드 UI 구현
  - `src/pages/LoginPage.tsx` - 리다이렉트 `/my` → `/` 변경

### 1.5 HashRouter 설정
- 정적 호스팅 배포를 위해 `createBrowserRouter` → `createHashRouter` 변경
- URL 형태: `/login` → `/#/login`
- **수정 파일**: `src/routes.tsx`

---

## 2. 현재 시스템 아키텍처

### 2.1 프론트엔드 (완료)
```
├── React 19 + TypeScript + Vite
├── React Router (HashRouter)
├── Tailwind CSS
├── 상태 관리: Context API (AuthContext)
└── 데이터 저장: localStorage (Mock)
```

### 2.2 백엔드 (미구현 - Mock 상태)
```
현재: localStorage + mockData.ts
목표: 실제 서버 API + 데이터베이스
```

---

## 3. 백엔드 개발 플랜

### 3.1 기술 스택 선택지

| 옵션 | 장점 | 단점 |
|------|------|------|
| **Supabase** | 빠른 구축, 인증 내장, 실시간 기능 | 종속성, 비용 |
| **Firebase** | 실시간 DB, 호스팅 통합 | NoSQL 제약 |
| **Node.js + Express + PostgreSQL** | 완전한 제어, 확장성 | 구축 시간 |
| **NestJS + TypeORM** | 구조화된 코드, TypeScript | 러닝 커브 |

**권장**: Supabase (MVP 빠른 구축) 또는 NestJS (장기적 확장성)

### 3.2 데이터베이스 스키마 설계

```sql
-- 회원 테이블
CREATE TABLE members (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  name VARCHAR(100) NOT NULL,
  phone VARCHAR(20),
  birth_date DATE,
  gender VARCHAR(10),
  position VARCHAR(50),
  referrer VARCHAR(100),
  motivation TEXT,
  swimming_ability JSONB,
  status VARCHAR(20) DEFAULT 'active',  -- active, inactive, withdrawn
  role VARCHAR(20) DEFAULT 'member',     -- admin, member
  joined_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 가입 신청 테이블
CREATE TABLE applications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  email VARCHAR(255) NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  phone VARCHAR(20),
  birth_date DATE,
  referrer VARCHAR(100),
  swimming_ability JSONB,
  motivation TEXT,
  agreed_to_terms BOOLEAN DEFAULT FALSE,
  agreed_to_privacy BOOLEAN DEFAULT FALSE,
  status VARCHAR(20) DEFAULT 'pending',  -- pending, approved, rejected
  reject_reason TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  processed_at TIMESTAMP,
  processed_by UUID REFERENCES members(id)
);

-- 상태 변경 신청 테이블
CREATE TABLE state_changes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  member_id UUID REFERENCES members(id),
  current_status VARCHAR(20) NOT NULL,
  requested_status VARCHAR(20) NOT NULL,
  reason TEXT,
  status VARCHAR(20) DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT NOW(),
  processed_at TIMESTAMP,
  processed_by UUID REFERENCES members(id)
);

-- 탈퇴 신청 테이블
CREATE TABLE withdrawal_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  member_id UUID REFERENCES members(id),
  reason TEXT,
  status VARCHAR(20) DEFAULT 'pending',
  reject_reason TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  processed_at TIMESTAMP,
  processed_by UUID REFERENCES members(id)
);

-- 상태 변경 이력 테이블
CREATE TABLE status_change_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  member_id UUID REFERENCES members(id),
  member_name VARCHAR(100),
  change_type VARCHAR(20),  -- joined, to_inactive, to_active, withdrawn
  from_status VARCHAR(20),
  to_status VARCHAR(20),
  changed_at TIMESTAMP DEFAULT NOW()
);

-- 시스템 설정 테이블
CREATE TABLE settings (
  key VARCHAR(50) PRIMARY KEY,
  value JSONB NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 체크리스트 항목 테이블
CREATE TABLE checklist_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  label VARCHAR(255) NOT NULL,
  description TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  sort_order INT DEFAULT 0
);
```

### 3.3 API 엔드포인트 설계

```
인증
├── POST   /api/auth/login        - 로그인
├── POST   /api/auth/logout       - 로그아웃
└── GET    /api/auth/me           - 현재 사용자 정보

회원
├── GET    /api/members           - 회원 목록 조회
├── GET    /api/members/:id       - 회원 상세 조회
├── PUT    /api/members/:id       - 회원 정보 수정 (관리자)
└── GET    /api/members/stats     - 회원 통계 (정원 현황)

가입 신청
├── POST   /api/applications              - 가입 신청
├── GET    /api/applications              - 신청 목록 (관리자)
├── PUT    /api/applications/:id/approve  - 신청 승인 (관리자)
└── PUT    /api/applications/:id/reject   - 신청 반려 (관리자)

상태 변경
├── POST   /api/state-changes             - 상태 변경 신청
├── GET    /api/state-changes             - 신청 목록 (관리자)
├── PUT    /api/state-changes/:id/approve - 승인 (관리자)
└── PUT    /api/state-changes/:id/reject  - 반려 (관리자)

탈퇴 신청
├── POST   /api/withdrawals               - 탈퇴 신청
├── GET    /api/withdrawals               - 신청 목록 (관리자)
├── PUT    /api/withdrawals/:id/approve   - 승인 (관리자)
└── PUT    /api/withdrawals/:id/reject    - 반려 (관리자)

대시보드
├── GET    /api/dashboard/recent-joined   - 최근 가입 회원
└── GET    /api/dashboard/recent-changes  - 최근 상태 변경

설정 (관리자)
├── GET    /api/settings                  - 설정 조회
├── PUT    /api/settings                  - 설정 수정
├── GET    /api/checklist                 - 체크리스트 조회
└── PUT    /api/checklist                 - 체크리스트 수정
```

### 3.4 프론트엔드 연동 작업

1. **API 클라이언트 구현** (`src/lib/apiClient.ts`)
   ```typescript
   // axios 또는 fetch 래퍼
   const apiClient = {
     get: (url) => fetch(BASE_URL + url),
     post: (url, data) => fetch(BASE_URL + url, { method: 'POST', body: JSON.stringify(data) }),
     // ...
   };
   ```

2. **기존 api.ts 함수 교체**
   - `getMembers()` → `apiClient.get('/api/members')`
   - `login()` → `apiClient.post('/api/auth/login')`
   - 등등...

3. **React Query 도입 (권장)**
   - 서버 상태 관리
   - 캐싱, 리페칭, 에러 핸들링

### 3.5 개발 단계

| 단계 | 작업 내용 | 예상 기간 |
|------|----------|----------|
| 1단계 | DB 스키마 생성 + 백엔드 프로젝트 셋업 | - |
| 2단계 | 인증 API (로그인/로그아웃) | - |
| 3단계 | 회원 CRUD API | - |
| 4단계 | 가입/상태변경/탈퇴 신청 API | - |
| 5단계 | 프론트엔드 API 연동 | - |
| 6단계 | 배포 (프론트 + 백엔드) | - |

---

## 4. 커밋 메시지 제안

### 현재 스테이지 상태 분석

**스테이지된 파일** (다른 세션 작업 포함):
- 가입 신청 3단계 플로우 개편
- 회칙/운영규정 통합 관리
- 관리자 기능 개선
- 모바일 UI 개선
- 등등...

**스테이지 안 된 파일** (이 세션 작업):
- `src/pages/HomePage.tsx` - 일반 회원 대시보드
- `src/pages/MyPage.tsx` - (다른 세션에서 수정)
- `src/routes.tsx` - HashRouter 변경

### 커밋 메시지 제안

#### 옵션 A: 전체 통합 커밋
```
feat: MVP 2차 개발 - 가입 플로우 개편 및 회원 대시보드 구현

- 가입 신청 3단계 플로우 (회칙확인 → 기본정보 → 부가정보)
- 회칙/운영규정 단일 소스 관리 (rules.md)
- 일반 회원 대시보드 홈 구현 (최근 가입/상태변경 표시)
- 정원 마감 시 가입 신청 차단 기능
- 관리자 신청 관리 통합 (가입/휴면/탈퇴)
- HashRouter 적용 (정적 호스팅 지원)
- 모바일 UI/UX 개선
```

#### 옵션 B: 기능별 분리 커밋 (권장)
```
# 1차 커밋 (이미 스테이지된 내용)
feat: 가입 신청 플로우 3단계 개편 및 회칙 통합 관리

- 가입 신청 3단계 플로우 구현 (회칙확인 → 기본정보 → 부가정보)
- 회칙/운영규정 단일 소스 관리 (public/rules/rules.md)
- 관리자 신청 관리 페이지 통합 (가입/휴면/탈퇴)
- 수모 가격 정보 일관성 수정
- 모바일 UI/UX 개선

# 2차 커밋 (이 세션 작업)
feat: 회원 대시보드 및 정원 마감 기능 구현

- 일반 회원 대시보드 홈 구현
- 최근 가입 회원 / 상태 변경 표시
- 정원 마감 시 가입 신청 차단
- HashRouter 적용 (정적 호스팅 지원)
```

---

## 5. 다음 단계 권장 사항

1. **현재 MVP 테스트 완료 후 배포**
2. **사용자 피드백 수집**
3. **백엔드 기술 스택 결정**
4. **백엔드 개발 착수**
5. **프론트엔드-백엔드 연동**
