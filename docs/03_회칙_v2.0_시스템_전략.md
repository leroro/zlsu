# 회칙 v2.0 시스템 구현 전략

**작성일**: 2026-02-08
**목표**: 회칙 v2.0이 실제로 돌아가는 시스템 만들기

---

## 1. 핵심 목표

회칙 v2.0은 다음을 규정하고 있다:
- **정원 14명** 관리 (가입/휴면/복귀/탈퇴)
- **회원 레벨** 자동 산정 (출석률 + 이벤트 참여)
- **벌금 제도** 운영 (지각/무단불참/수모 미착용)
- **수모 구매** 관리 (3가지 옵션)
- **휴면/복귀** 규정 (최대 2개월, 월 단위)

→ 이 모든 것이 시스템으로 자연스럽게 돌아가야 한다.

---

## 2. 현재 상태 vs 필요한 시스템

### 2.1 가입 폼 (Step 3: 기본정보 / Step 4: 부가정보)

| 항목 | 현재 시스템 | 회칙 v2.0 요구 | 불일치 |
|------|-----------|---------------|--------|
| **주종목** | "2개 이상 선택" | "4개 영법 모두 가능"이 가입 조건 | ⚠️ 조건 자체가 다름 |
| **대회 참가 의향** | 대회만 물어봄 | "티타임 및 이벤트 참여 의향"이 가입 조건 | ⚠️ 범위가 다름 |
| **수모 선택** | 체크리스트 항목 하나 (가격도 틀림) | 3가지 옵션 중 선택 필수 | ❌ 미구현 |
| **수모 벌금** | 체크리스트에 없음 | 미착용 시 1,000원 (2/21~) | ❌ 미반영 |
| **자유형 50m** | 수영 레벨만 물어봄 | "자유형 50m 페이스 유지" 명시 | ⚠️ 불명확 |

### 2.2 회원 레벨 시스템

| 항목 | 현재 시스템 | 필요한 시스템 |
|------|-----------|-------------|
| **레벨 산정** | 관리자 수동 지정 | **자동 계산** |
| **출석 데이터** | ❌ 없음 | 토요일 출석 기록 필요 |
| **이벤트 참여** | ❌ 없음 | 이벤트 참석 기록 필요 |
| **레벨 기준** | 상수로만 정의 | 실제 계산 로직 필요 |

#### 레벨 자동 계산에 필요한 데이터

```
뉴비: joinedAt 이후 출석 < 4회
일반: 최근 2개월 출석 4~5회
열정: 최근 2개월 출석 6회 이상
핵심: 열정 + 이벤트 참여
스텝: 수동 지정 (운영진)
```

**→ 출석 기록 시스템이 가장 핵심 선행 과제**

### 2.3 정원 관리

| 항목 | 현재 시스템 | 필요한 시스템 |
|------|-----------|-------------|
| **정원 체크** | ✅ 가입 시 체크 | OK |
| **휴면 → 공석** | ❌ 자동 아님 | 휴면 시 정원 차감 |
| **복귀 → 정원 확인** | ✅ 부분 구현 | OK |
| **3개월 휴면 → 공석 처리** | ❌ 미구현 | 자동 처리 필요 |
| **회비 미납 → 휴면+공석** | ❌ 미구현 | 규정만 안내 (수동 처리) |

---

## 3. 구현 전략 (우선순위순)

### Phase 1: 가입 폼 회칙 정합성 (즉시)

**목표**: 가입 시 회칙이 요구하는 정보를 정확하게 수집

#### 1-1. 가입 조건 명확화 (Step 4 수정)

현재 "주종목 2개 이상"을 → **가입 조건 확인**으로 변경:

```
□ 자유형 50m 페이스 유지하며 완주 가능
□ 4개 영법(자유형/배영/평영/접영) 모두 가능
□ 티타임 및 각종 이벤트에 참여할 의향이 있음
```

**이유**: 회칙에서 이 3가지가 가입 조건인데, 현재 폼은 이걸 명확히 확인하지 않음

#### 1-2. 수모 옵션 선택 추가 (Step 4에 추가)

```
수모 선택 (필수):
○ 메쉬 수모 1장 (2만원)
○ 메쉬 수모 2장 (2.5만원, 장당 1.25만원) ← 권장
○ 실리콘 수모 1장 (1만원)
```

**이유**: 회칙에서 "가입 시 3가지 옵션 중 선택"으로 명시

#### 1-3. 체크리스트 수정 (Step 2)

- **수모 항목**: 가격 수정 + 문구 변경 (선택 항목이므로 체크리스트에서는 "수모 착용 필수 및 미착용 시 벌금 1,000원"으로)
- **수모 벌금 항목 추가**: "팀 수모 미착용 시 벌금 1,000원 (2026.02.21부터 시행)"

#### 1-4. 수영 정보 재구성

현재 Step 4의 구조:
```
[수영 레벨] → [대회 참가 의향] → [주종목 2개+] → [자기소개]
```

변경 후:
```
[가입 조건 확인 3항목] → [수영 레벨] → [주종목 선택] → [수모 선택] → [자기소개]
```

- **대회 참가 의향**: 가입 조건의 "이벤트 참여 의향"으로 대체 (대회만 따로 묻는 건 회칙과 안 맞음)
- **주종목**: 4개 영법 가능 여부는 조건 확인에서 처리, 주종목은 "가장 자신 있는 종목"으로 변경

---

### Phase 2: 출석 기록 시스템 (핵심 인프라)

**목표**: 레벨 자동 계산의 기반 데이터 구축

#### 2-1. 데이터 모델

```typescript
interface AttendanceRecord {
  id: string;
  date: string;           // "2026-02-08" (토요일)
  memberId: string;
  status: 'present' | 'late' | 'absent_notified' | 'absent_unnotified';
  lateMinutes?: number;   // 지각 시 분 단위
  fineAmount?: number;    // 벌금 (자동 계산)
  note?: string;
}
```

#### 2-2. 출석 입력 방식 (검토 필요)

**옵션 A**: 관리자가 매주 출석부 입력
- 장점: 단순, 즉시 구현 가능
- 단점: 관리자 부담

**옵션 B**: 카카오 단톡방 일정 연동
- 장점: 현재 운영 프로세스와 일치 (금요일 출석체크)
- 단점: API 연동 필요, 복잡

**→ 권장: 옵션 A로 시작, 추후 B 검토**

#### 2-3. 출석 관리 화면

- 관리자 메뉴에 "출석 관리" 추가
- 해당 주 토요일 날짜 자동 설정
- 활동 회원 목록 표시, 출석/지각/불참(사전)/무단불참 선택
- 지각 시 분 입력 → 벌금 자동 계산

---

### Phase 3: 회원 레벨 자동 계산

**목표**: 출석 데이터 기반 레벨 자동 산정

#### 3-1. 계산 로직

```typescript
function calculateActivityLevel(member: Member, attendances: AttendanceRecord[]): ActivityLevel {
  // 스텝은 수동 지정 유지
  if (member.activityLevel === 'staff') return 'staff';

  const twoMonthsAgo = /* 2개월 전 날짜 */;
  const recentAttendances = attendances.filter(a =>
    a.memberId === member.id &&
    a.date >= twoMonthsAgo &&
    (a.status === 'present' || a.status === 'late')
  );
  const attendCount = recentAttendances.length;

  // 뉴비: 가입 후 총 출석 4회 미만
  const totalAttendances = attendances.filter(a =>
    a.memberId === member.id &&
    (a.status === 'present' || a.status === 'late')
  );
  if (totalAttendances.length < 4) return 'newbie';

  // 핵심: 열정 + 이벤트 참여 (이벤트 참여는 별도 데이터 필요)
  // → Phase 4에서 이벤트 시스템 구현 후 적용

  if (attendCount >= 6) return 'passionate';  // 열정
  if (attendCount >= 4) return 'regular';      // 일반

  return 'newbie'; // 그 외
}
```

#### 3-2. 레벨 갱신 시점

- 매주 토요일 출석 입력 후 자동 재계산
- 관리자 화면에서 레벨 변동 알림

---

### Phase 4: 이벤트/활동 기록 (핵심 레벨용)

**목표**: 핵심(🦈) 레벨 판단을 위한 이벤트 참여 추적

- 이벤트 생성/참여 기록 시스템
- 번개, 대회, 티타임 등 기록
- Phase 3의 레벨 계산에 반영

---

## 4. 구현 순서 요약

```
Phase 1 (지금 바로)
├── 1-1. 가입 조건 3항목 확인 UI
├── 1-2. 수모 옵션 선택 추가
├── 1-3. 체크리스트 수정 (수모 가격/벌금)
└── 1-4. Step 4 구조 재배치

Phase 2 (출석 인프라)
├── 2-1. AttendanceRecord 타입 정의
├── 2-2. 출석 CRUD API
└── 2-3. 관리자 출석 관리 화면

Phase 3 (레벨 자동화)
├── 3-1. 레벨 계산 로직
├── 3-2. 레벨 갱신/표시
└── 3-3. 레벨 변동 알림

Phase 4 (이벤트 확장)
├── 4-1. 이벤트 기록 시스템
└── 4-2. 핵심 레벨 자동 판별
```

---

## 5. 사용자 확인 필요 사항

### Q1. 대회 참가 의향 항목 처리
현재 "대회 참가 의향"을 별도로 물어보고 있는데, 회칙에서는 "티타임 및 각종 이벤트 참여 의향"이 가입 조건.
- **A안**: "대회 참가 의향" 삭제, 가입 조건 체크로 대체
- **B안**: 가입 조건 체크 + "대회 참가 의향"도 별도 유지 (참고 정보로)

### Q2. 주종목 선택 방식
회칙에서 "4개 영법 모두 가능"이 가입 조건인데, 주종목도 별도로 물어볼 필요가 있는가?
- **A안**: 가입 조건에서 4영법 확인만, 주종목 삭제
- **B안**: 4영법 확인 + 주종목(가장 자신 있는 것) 1~2개 선택 유지

### Q3. 수모 옵션을 가입 폼에 넣을 것인가?
- **A안**: 가입 폼 Step 4에서 수모 옵션 선택 (주문 접수 역할)
- **B안**: 가입 폼에서는 안내만, 실제 구매는 가입 후 별도 처리

---

## 6. 변경 영향 범위

### 수정 파일 (Phase 1)
| 파일 | 변경 내용 |
|------|----------|
| `src/pages/ApplyPage.tsx` | Step 4 재구성 (가입조건/수모/주종목) |
| `src/lib/constants.ts` | 체크리스트 항목 수정, 수모 옵션 상수 추가 |
| `src/lib/types.ts` | SwimCapOption 타입 추가, Member에 swimCapChoice 필드 |
| `src/lib/api.ts` | createPendingMember 수정 |

### 신규 파일 (Phase 2)
| 파일 | 내용 |
|------|------|
| `src/pages/admin/AttendancePage.tsx` | 출석 관리 화면 |
| `src/lib/attendance.ts` | 출석 API 함수 |

---

*이 문서는 구현 진행에 따라 업데이트합니다.*
