# 회칙 v2.0 시스템 구현 전략

**작성일**: 2026-02-08
**목표**: 회칙 v2.0이 실제로 돌아가는 시스템 만들기

---

## 1. 핵심 목표

회칙 v2.0은 다음을 규정하고 있다:
- **정원 14명** 관리 (가입/휴면/복귀/탈퇴)
- **회원 레벨** 자동 산정 (출석률 + 이벤트 참여)
- **벌금 제도** 운영 (지각/무단불참/수모 미착용)
- **수모 구매** 관리 (3가지 옵션)
- **휴면/복귀** 규정 (최대 2개월, 월 단위)

→ 이 모든 것이 시스템으로 자연스럽게 돌아가야 한다.

---

## 2. 현재 상태 vs 필요한 시스템

### 2.1 가입 폼 (Step 3: 기본정보 / Step 4: 부가정보)

| 항목 | 현재 시스템 | 회칙 v2.0 요구 | 불일치 |
|------|-----------|---------------|--------|
| **주종목** | "2개 이상 선택" | "4개 영법 모두 가능"이 가입 조건 | ⚠️ 조건 자체가 다름 |
| **대회 참가 의향** | 대회만 물어봄 | "티타임 및 이벤트 참여 의향"이 가입 조건 | ⚠️ 범위가 다름 |
| **수모 선택** | 체크리스트 항목 하나 (가격도 틀림) | 3가지 옵션 중 선택 필수 | ❌ 미구현 |
| **수모 벌금** | 체크리스트에 없음 | 미착용 시 1,000원 (2/21~) | ❌ 미반영 |
| **자유형 50m** | 수영 레벨만 물어봄 | "자유형 50m 페이스 유지" 명시 | ⚠️ 불명확 |

### 2.2 회원 레벨 시스템

| 항목 | 현재 시스템 | 필요한 시스템 |
|------|-----------|-------------|
| **레벨 산정** | 관리자 수동 지정 | **자동 계산** |
| **출석 데이터** | ❌ 없음 | 토요일 출석 기록 필요 |
| **이벤트 참여** | ❌ 없음 | 이벤트 참석 기록 필요 |
| **레벨 기준** | 상수로만 정의 | 실제 계산 로직 필요 |

#### 레벨 자동 계산에 필요한 데이터

```
뉴비: joinedAt 이후 출석 < 4회
일반: 최근 2개월 출석 4~5회
열정: 최근 2개월 출석 6회 이상
핵심: 열정 + 이벤트 참여
스텝: 수동 지정 (운영진)
```

**→ 출석 기록 시스템이 가장 핵심 선행 과제**

### 2.3 정원 관리

| 항목 | 현재 시스템 | 필요한 시스템 |
|------|-----------|-------------|
| **정원 체크** | ✅ 가입 시 체크 | OK |
| **휴면 → 공석** | ❌ 자동 아님 | 휴면 시 정원 차감 |
| **복귀 → 정원 확인** | ✅ 부분 구현 | OK |
| **3개월 휴면 → 공석 처리** | ❌ 미구현 | 자동 처리 필요 |
| **회비 미납 → 휴면+공석** | ❌ 미구현 | 규정만 안내 (수동 처리) |

---

## 3. 구현 전략 (우선순위순)

### Phase 1: 가입 폼 재설계 (즉시)

**목표**: 회칙이 요구하는 자격/정보를 올바른 순서로 검증 및 수집

#### 설계 원칙

1. **탈락 가능성 높은 것을 앞에** — 개인정보 다 입력하고 자격 미달 → 최악의 UX
2. **자격 확인과 계정 생성을 분리** — 인증 방식(이메일/SNS)이 바뀌어도 앞 단계가 안 무너짐
3. **게스트 → 정회원 확장 구조** — 나중에 게스트 가입을 추가해도 Step 1까지만 분기하면 됨

#### 변경 전 vs 변경 후

```
[현재]                          [변경 후]
Step 1: 추천인 확인              Step 1: 수영 자격 확인
Step 2: 약관 동의                Step 2: 정회원 요건 확인
Step 3: 기본 정보                Step 3: 계정 생성 + 개인정보
Step 4: 부가 정보 (수영 등)
```

#### Step 1: 수영 자격 확인 (게스트 기본 요건)

InfoPage(AboutContent.tsx)의 게스트 참여 조건과 동일:

```
✅ 수영 자격
  □ 자유형 50m 페이스 유지하며 완주 가능
  □ 4개 영법(자유형/배영/평영/접영) 모두 가능
```

**→ 통과: 최소한 게스트로 참여 가능한 자격 확인됨**
**→ 미달: "아직은 개인 연습 후 다시 도전해 주세요" 안내**

**확장 포인트**: 나중에 게스트 가입 기능 추가 시, 이 단계만 통과하면
게스트 등록으로 분기 가능 (Step 2를 건너뜀)

#### Step 2: 정회원 요건 확인

게스트와 정회원의 차이를 만드는 단계:

```
✅ 추천인 확인
  - 열정 레벨 이상 회원 이름 입력 → 자격 검증

✅ 활동 참여 의향
  □ 티타임 및 각종 이벤트에 참여할 의향이 있음
    (수영만 배우실 분은 게스트로 참여 안내)

✅ 수모 선택
  ○ 메쉬 수모 1장 (2만원)
  ○ 메쉬 수모 2장 (2.5만원, 장당 1.25만원) ← 권장
  ○ 실리콘 수모 1장 (1만원)

✅ 약관 동의
  - 회칙 전문 보기 (끝까지 스크롤 필수)
  - 중요사항 체크리스트:
    - 8시 정각 도착 (57분까지)
    - 지각 벌금 (1분당 500원, 최대 1만원)
    - 무단불참 벌금 (1만원)
    - 월 회비 2만원 (매월 1일)
    - 납부 회비 환불 불가
    - 불참 시 토요일 새벽 4시까지 일정 불참 표시
    - 팀 수모 착용 필수 (미착용 시 1,000원)
    - 개인정보 수집 동의
```

**→ 모두 충족해야 Step 3 진행 가능**

**참고**: Step 2는 내용이 많아서 UI상 서브 단계로 나눌 수 있음
(추천인 → 수모 선택 → 약관 동의 등). 인디케이터는 3단계 유지.

#### Step 3: 계정 생성 + 개인정보

자격/요건 확인을 모두 마친 사람만 여기 도달:

```
[계정 생성]
  현재: 이메일, 비밀번호
  미래: 카카오 로그인 (OAuth) ← 이 부분만 교체하면 됨

[기본 정보]
  이름, 전화번호, 생년월일
  (카카오 로그인 시 자동 채움 가능)

[수영 정보]
  수영 레벨 (초급/중급/상급/마스터)
  주종목 선택 (가장 자신 있는 종목, 참고용)

[자기소개]
  가입 동기나 소개 (팀원들에게 공유)
```

#### SNS 로그인 도입 시 영향 분석

| 단계 | 카카오 로그인 도입 시 | 영향도 |
|------|---------------------|-------|
| Step 1 (수영 자격) | 변경 없음 | 없음 |
| Step 2 (정회원 요건) | 변경 없음 | 없음 |
| Step 3 (계정 생성) | 이메일/비밀번호 → 카카오 OAuth 교체 | **여기만 변경** |

→ Step 1~2는 "자격 확인" 영역, Step 3은 "인증/등록" 영역으로 완전 분리됨

#### 데이터 기록 시점

- Step 1~2의 확인 항목은 클라이언트 상태(메모리)에만 존재
- Step 3 최종 제출 시 한꺼번에 DB에 기록 (`joinedAt` = 자격 확인 + 약관 동의 + 가입 신청 시점)
- 중간 단계별 타임스탬프는 불필요 (실익 없음)

**삭제 항목:**
- ~~대회 참가 의향~~ → Step 2의 "이벤트 참여 의향"으로 대체
- ~~주종목 2개 이상 필수~~ → 4영법 가능은 Step 1에서 확인, 주종목은 참고 정보로 변경

---

### Phase 2: 출석 기록 시스템 (핵심 인프라)

**목표**: 레벨 자동 계산의 기반 데이터 구축

#### 2-1. 데이터 모델

```typescript
interface AttendanceRecord {
  id: string;
  date: string;           // "2026-02-08" (토요일)
  memberId: string;
  status: 'present' | 'late' | 'absent_notified' | 'absent_unnotified';
  lateMinutes?: number;   // 지각 시 분 단위
  fineAmount?: number;    // 벌금 (자동 계산)
  note?: string;
}
```

#### 2-2. 출석 입력 방식 (검토 필요)

**옵션 A**: 관리자가 매주 출석부 입력
- 장점: 단순, 즉시 구현 가능
- 단점: 관리자 부담

**옵션 B**: 카카오 단톡방 일정 연동
- 장점: 현재 운영 프로세스와 일치 (금요일 출석체크)
- 단점: API 연동 필요, 복잡

**→ 권장: 옵션 A로 시작, 추후 B 검토**

#### 2-3. 출석 관리 화면

- 관리자 메뉴에 "출석 관리" 추가
- 해당 주 토요일 날짜 자동 설정
- 활동 회원 목록 표시, 출석/지각/불참(사전)/무단불참 선택
- 지각 시 분 입력 → 벌금 자동 계산

---

### Phase 3: 회원 레벨 자동 계산

**목표**: 출석 데이터 기반 레벨 자동 산정

#### 3-1. 계산 로직

```typescript
function calculateActivityLevel(member: Member, attendances: AttendanceRecord[]): ActivityLevel {
  // 스텝은 수동 지정 유지
  if (member.activityLevel === 'staff') return 'staff';

  const twoMonthsAgo = /* 2개월 전 날짜 */;
  const recentAttendances = attendances.filter(a =>
    a.memberId === member.id &&
    a.date >= twoMonthsAgo &&
    (a.status === 'present' || a.status === 'late')
  );
  const attendCount = recentAttendances.length;

  // 뉴비: 가입 후 총 출석 4회 미만
  const totalAttendances = attendances.filter(a =>
    a.memberId === member.id &&
    (a.status === 'present' || a.status === 'late')
  );
  if (totalAttendances.length < 4) return 'newbie';

  // 핵심: 열정 + 이벤트 참여 (이벤트 참여는 별도 데이터 필요)
  // → Phase 4에서 이벤트 시스템 구현 후 적용

  if (attendCount >= 6) return 'passionate';  // 열정
  if (attendCount >= 4) return 'regular';      // 일반

  return 'newbie'; // 그 외
}
```

#### 3-2. 레벨 갱신 시점

- 매주 토요일 출석 입력 후 자동 재계산
- 관리자 화면에서 레벨 변동 알림

---

### Phase 4: 이벤트/활동 기록 (핵심 레벨용)

**목표**: 핵심(🦈) 레벨 판단을 위한 이벤트 참여 추적

- 이벤트 생성/참여 기록 시스템
- 번개, 대회, 티타임 등 기록
- Phase 3의 레벨 계산에 반영

---

## 4. 구현 순서 요약

```
Phase 1 (지금 바로) — 가입 폼 재설계 (4단계 → 3단계)
├── 1-1. Step 1 신규: 수영 자격 확인 (게스트 기본 요건)
├── 1-2. Step 2 신규: 정회원 요건 (추천인+이벤트의향+수모+약관)
├── 1-3. Step 3: 계정 생성 + 개인정보 (기존 Step 3+4 통합)
├── 1-4. 체크리스트 수모 항목 수정/벌금 추가
└── 1-5. 대회 참가 의향 삭제, 주종목 참고 정보로 변경

Phase 2 (출석 인프라)
├── 2-1. AttendanceRecord 타입 정의
├── 2-2. 출석 CRUD API
└── 2-3. 관리자 출석 관리 화면

Phase 3 (레벨 자동화)
├── 3-1. 레벨 계산 로직
├── 3-2. 레벨 갱신/표시
└── 3-3. 레벨 변동 알림

Phase 4 (이벤트 확장)
├── 4-1. 이벤트 기록 시스템
└── 4-2. 핵심 레벨 자동 판별
```

---

## 5. 변경 영향 범위

### 수정 파일 (Phase 1)
| 파일 | 변경 내용 |
|------|----------|
| `src/pages/ApplyPage.tsx` | 4단계→3단계 재설계 (자격확인/정회원요건/계정생성) |
| `src/lib/constants.ts` | 가입 조건 상수, 수모 옵션 상수, 체크리스트 수정 |
| `src/lib/types.ts` | SwimCapOption 타입 추가, Member에 swimCapChoice 필드 |
| `src/lib/api.ts` | createPendingMember 수정 |

### 신규 파일 (Phase 2)
| 파일 | 내용 |
|------|------|
| `src/pages/admin/AttendancePage.tsx` | 출석 관리 화면 |
| `src/lib/attendance.ts` | 출석 API 함수 |

---

*이 문서는 구현 진행에 따라 업데이트합니다.*
