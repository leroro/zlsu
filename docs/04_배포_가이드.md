# 즐수팀 운영 시스템 - 배포 가이드

**작성일**: 2025-01-20
**버전**: MVP 1.0

---

## 목차

1. [GitHub Pages 배포](#1-github-pages-배포)
2. [자동 배포 설정](#2-자동-배포-설정)
3. [수동 배포 방법](#3-수동-배포-방법)
4. [배포 후 확인사항](#4-배포-후-확인사항)
5. [문제 해결](#5-문제-해결)

---

## 1. GitHub Pages 배포

### 1.1 사전 준비

1. GitHub 저장소 생성 (이미 완료된 경우 건너뛰기)
2. 저장소 Settings → Pages 이동
3. Source를 "GitHub Actions"로 설정

### 1.2 배포 URL

배포 완료 후 접속 URL:
```
https://[username].github.io/zlsu/
```

---

## 2. 자동 배포 설정

### 2.1 GitHub Actions 워크플로우

`.github/workflows/deploy.yml` 파일이 이미 설정되어 있습니다.

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main
      - develop
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

### 2.2 자동 배포 트리거

다음 경우에 자동으로 배포됩니다:
- `main` 브랜치에 push 시
- `develop` 브랜치에 push 시
- GitHub Actions 탭에서 수동 실행 시

### 2.3 배포 상태 확인

1. GitHub 저장소 → Actions 탭 이동
2. "Deploy to GitHub Pages" 워크플로우 확인
3. 초록색 체크: 배포 성공
4. 빨간색 X: 배포 실패 (로그 확인 필요)

---

## 3. 수동 배포 방법

### 3.1 로컬에서 빌드

```bash
# 빌드 실행
npm run build

# 빌드 결과 확인
ls -la dist/
```

### 3.2 GitHub에 푸시

```bash
# 변경사항 커밋
git add .
git commit -m "Build: production build"

# 푸시 (자동 배포 트리거)
git push origin main
```

### 3.3 수동 워크플로우 실행

1. GitHub 저장소 → Actions 탭
2. "Deploy to GitHub Pages" 선택
3. "Run workflow" 버튼 클릭
4. 브랜치 선택 후 "Run workflow" 클릭

---

## 4. 배포 후 확인사항

### 4.1 기본 확인

- [ ] 메인 페이지 접속 확인
- [ ] 정원 현황 표시 확인
- [ ] 로그인 기능 확인
- [ ] 페이지 이동(라우팅) 확인

### 4.2 기능 확인

- [ ] 가입 신청 폼 제출
- [ ] 관리자 로그인 및 기능
- [ ] 회칙 페이지 로드
- [ ] 모바일 반응형 확인

### 4.3 주의사항

1. **Base URL**: GitHub Pages는 `/zlsu/` 경로를 사용합니다.
2. **404 처리**: SPA이므로 직접 URL 접근 시 GitHub Pages 404 페이지가 나올 수 있습니다.
3. **로컬 스토리지**: 배포 환경에서도 브라우저 로컬 스토리지를 사용합니다.

---

## 5. 문제 해결

### 5.1 빌드 실패

```bash
# 로컬에서 빌드 테스트
npm run build

# 타입 에러 확인
npx tsc --noEmit
```

### 5.2 페이지 404 에러

1. `vite.config.ts`의 `base` 설정 확인:
   ```typescript
   export default defineConfig({
     base: '/zlsu/',
   })
   ```

2. 라우터 basename 확인 (`src/routes.tsx`):
   ```typescript
   const basename = import.meta.env.BASE_URL;
   ```

### 5.3 자동 배포 미작동

1. GitHub Actions 활성화 확인
2. 저장소 Settings → Actions → General
3. "Allow all actions" 선택
4. 워크플로우 파일 문법 확인

### 5.4 GitHub Pages 설정 확인

1. Settings → Pages 이동
2. Source: "GitHub Actions" 선택
3. Branch 설정이 비활성화되어 있는지 확인

---

## 부록: Supabase Keepalive

### 설정 목적

Supabase 무료 플랜은 7일 이상 비활성 시 프로젝트가 일시 중지됩니다.
Keepalive 워크플로우가 주기적으로 Supabase에 요청을 보내 이를 방지합니다.

### 워크플로우 파일

`.github/workflows/keepalive.yml`:

```yaml
name: Supabase Keepalive

on:
  schedule:
    - cron: '0 9 * * 1'  # 매주 월요일 오전 9시 (UTC)
  workflow_dispatch:

jobs:
  keepalive:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase
        run: |
          echo "Supabase keepalive ping"
          # Supabase 연동 시 주석 해제
          # curl -X GET "${{ secrets.SUPABASE_URL }}/rest/v1/" \
          #   -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}"
```

### Supabase 연동 시 설정

1. GitHub 저장소 → Settings → Secrets and variables → Actions
2. 다음 시크릿 추가:
   - `SUPABASE_URL`: Supabase 프로젝트 URL
   - `SUPABASE_ANON_KEY`: Supabase anon/public 키
3. 워크플로우 파일에서 curl 명령 주석 해제

---

**문서 끝**
